- id: 'Запустить таймер при включении ночника в прихожей'
  alias: ha_start_timer_on_night_light_switched_on
  trigger:
    - platform: state
      entity_id: light.ha_sls
      to: 'on'
  action:
    - service: timer.start
      entity_id: timer.ha_night_light

- id: 'Включить ночник в прихожей при движении после захода солнца'
  alias: ha_enable_night_light_after_sunset
  trigger:
    - platform: state
      entity_id: binary_sensor.co_motionbathroom_occupancy
      to: 'on'
    - platform: state
      entity_id: binary_sensor.co_motionkitchen_occupancy
      to: 'on'
    - platform: state
      entity_id: binary_sensor.co_motionmirror_occupancy
      to: 'on'
  condition:
    - condition: template  # from sunset until sunrise
      value_template: "{{ state_attr('sun.sun', 'elevation') < 1 }}"
    - condition: numeric_state
      entity_id: sensor.co_motionbathroom_illuminance
      below: 10
    - condition: state
      entity_id: light.co_light
      state: 'off'
    - condition: state
      entity_id: light.co_mirror_light
      state: 'off'
    - condition: state
      entity_id: light.ha_light
      state: 'off'
  action:
    - service: light.turn_on
      data:
        entity_id: light.ha_sls
        brightness_pct: 70
        rgb_color: [255,0,0]

- id: 'Отменять таймер при появлении движения на датчиках коридора (для прихожей)'
  alias: ha_stop_timer_on_night_light_switched_on_and_motion_detected
  trigger:
    - platform: state
      entity_id: binary_sensor.co_motionbathroom_occupancy
      to: 'on'
    - platform: state
      entity_id: binary_sensor.co_motionkitchen_occupancy
      to: 'on'
    - platform: state
      entity_id: binary_sensor.co_motionmirror_occupancy
      to: 'on'
  condition:
    - condition: state
      entity_id: light.ha_sls
      state: 'on'
  action:
    - service: timer.cancel
      entity_id: timer.ha_night_light

- id: 'Запускать таймер при включённом ночнике и отсутствии движения на всех датчиках коридора (для прихожей)'
  alias: ha_start_timer_on_night_light_switched_on_and_no_motion_detected
  trigger:
    - platform: state
      entity_id: binary_sensor.co_motionbathroom_occupancy
      to: 'off'
    - platform: state
      entity_id: binary_sensor.co_motionkitchen_occupancy
      to: 'off'
    - platform: state
      entity_id: binary_sensor.co_motionmirror_occupancy
      to: 'off'
  condition:
    - condition: state
      entity_id: light.ha_sls
      state: 'on'
    - condition: state
      entity_id: binary_sensor.co_motionbathroom_occupancy
      state: 'off'
    - condition: state
      entity_id: binary_sensor.co_motionkitchen_occupancy
      state: 'off'
    - condition: state
      entity_id: binary_sensor.co_motionmirror_occupancy
      state: 'off'
  action:
    - service: timer.start
      entity_id: timer.ha_night_light

- id: 'Выключить ночник в прихожей если включили основной свет или достаточно другого освещения'
  alias: ha_disable_night_light_if_main_light_switched_on
  trigger:
    - platform: numeric_state
      entity_id: sensor.co_motionbathroom_illuminance
      above: 10
    - platform: state
      entity_id: light.co_light
      to: 'on'
    - platform: state
      entity_id: light.co_mirror_light
      to: 'on'
  action:
    - service: light.turn_off
      entity_id: light.ha_sls

- id: 'Выключить ночник в прихожей по таймеру'
  alias: ha_disable_night_light_on_timer_finished
  trigger:
    - platform: event
      event_type: timer.finished
      event_data:
        entity_id: timer.ha_night_light
  action:
    - service: light.turn_off
      entity_id: light.ha_sls
